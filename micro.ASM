COMM1	EQU	0FFC8H
COMM2	EQU	0FFCAH
CNT	EQU	3FD6H
BPORT	EQU 	3FD2H

CODE    	SEGMENT
        	ASSUME  CS:CODE,DS:CODE

START:		CLI
		MOV	SP,4000H
		MOV	AX,CS
		MOV	DS,AX

		MOV	AX,0
		MOV	ES,AX
		MOV	BX,2*4
		MOV	ES:WORD PTR[BX],OFFSET NMI
		MOV	ES:2[BX],CS

		MOV	BX,40H*4
		MOV	ES:WORD PTR[BX],OFFSET INTR0
		MOV	ES:2[BX],CS

		MOV	DX,COMM1	;A0=0
		MOV	AL,00010011B	;ICW1
		OUT	DX,AL
		
		MOV	DX,COMM2	;A0=1
		MOV	AL,40H		;ICW2
		OUT	DX,AL

		MOV	AL,00000101B	;ICW4
		OUT	DX,AL

		MOV	AL,11111110B	;OCW1
		OUT	DX,AL

;================================================

		MOV	DX,CNT
		MOV	AL,80H
		OUT	DX,AL
		MOV	DX,BPORT

		STI

		JMP	$

NMI:   		MOV	AL,1
		MOV	AH,8
J1:		OUT	DX,AL
		MOV	CX,5FFFH
		LOOP	$
		ROL	AL,1
		DEC	AH
		JZ	NMI
		JMP	J1
		IRET


INTR0:   	MOV	AL,80H
		MOV	AH,8
J2:		OUT	DX,AL
		MOV	CX,5FFFH
		LOOP	$
		ROR	AL,1
		DEC	AH
		JZ	INTR0
		JMP	J2
		MOV	DX,COMM1
		MOV	AL,20H
		OUT	DX,AL
		IRET


CODE    	ENDS
        	END	START
